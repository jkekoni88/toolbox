<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ToolBox - Tekninen dokumentaatio</title>
  <style>
    :root{
      --bg:#111827;
      --bg2:rgba(15,23,42,0.75);
      --ink:#f8fafc;
      --muted:#cbd5e1;
      --muter:#94a3b8;
      --brand:#0b1120;
      --accent:#1d4ed8;
      --accent2:#3b82f6;
      --border:#1f2937;
      --kbd:rgba(11,18,32,0.9);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      position:relative;
      overflow-x:hidden;
    }
    body::before,
    body::after{
      content:"";
      position:fixed;
      width:420px;
      height:420px;
      border-radius:50%;
      filter:blur(120px);
      opacity:0.45;
      pointer-events:none;
      z-index:0;
    }
    body::before{
      top:-140px;
      left:-160px;
      background:radial-gradient(circle at center, rgba(59,130,246,0.55) 0%, rgba(67,56,202,0.22) 48%, rgba(17,24,39,0) 85%);
    }
    body::after{
      bottom:-160px;
      right:-120px;
      background:radial-gradient(circle at center, rgba(14,165,233,0.45) 0%, rgba(59,130,246,0.18) 52%, rgba(17,24,39,0) 90%);
    }
    body>*{
      position:relative;
      z-index:1;
    }

    #brandbar{position:sticky;top:0;z-index:3;background:var(--brand);color:#fff;
      display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid var(--border)}
    #brandbar .brand{font-weight:800;letter-spacing:.3px}
    #brandbar nav{display:flex;gap:8px;margin-left:10px;flex-wrap:wrap}
    #brandbar nav a{
      color:#d1d5db;
      text-decoration:none;
      padding:6px 10px;
      font-size:13px;
      border:none;
      background:none;
      box-shadow:none;
      border-radius:0;
      transition:color .2s ease;
    }
    #brandbar nav a:hover{
      color:#f8fafc;
    }
    #brandbar nav a.active{
      color:#f8fafc;
      border:1px solid rgba(148,163,184,0.35);
      border-radius:10px;
      background:linear-gradient(150deg, rgba(15,23,42,0.95) 0%, rgba(30,41,59,0.92) 55%, rgba(17,24,39,0.9) 100%);
      box-shadow:0 22px 48px -30px rgba(15,23,42,0.95);
    }
    #brandbar .spacer{flex:1}
    #brandbar .back a{color:#fff;text-decoration:none;font-weight:600}
    #brandbar .back a:hover{text-decoration:underline}

    main{max-width:1100px;margin:24px auto;padding:0 16px;display:grid;gap:24px}
    .card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:18px;display:grid;gap:12px}
    h1{font-size:28px;margin:0 0 4px}
    h2{font-size:20px;margin:4px 0}
    h3{font-size:15px;margin:4px 0;color:var(--muted)}
    p,li{color:var(--muted);line-height:1.55}
    ul{margin:0;padding-left:18px}
    code,kbd{background:var(--kbd);border:1px solid var(--border);border-radius:6px;padding:.1em .35em;font-size:.95em}
    pre{background:var(--kbd);border:1px solid var(--border);border-radius:6px;padding:12px;overflow:auto}
    .grid{display:grid;gap:12px}
    .cols{display:grid;gap:12px}
    .cols.two{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .note{background:var(--kbd);border:1px solid var(--border);border-radius:12px;padding:12px}
    .tagrow{display:flex;flex-wrap:wrap;gap:6px}
    .tag{background:#1f2937;color:#f1f5f9;border-radius:999px;padding:4px 10px;font-size:12px}
    details{border:1px solid var(--border);border-radius:6px;padding:10px 12px;background:#0b1220}
    details>summary{cursor:pointer;color:#e5e7eb;font-weight:600}
    a,a:visited,a:hover,a:active{color:#fff;font-weight:700;text-decoration:underline}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid var(--border);padding:8px;text-align:left;color:var(--muted);font-size:14px}
    th{color:var(--ink);background:#111827}
  </style>
</head>
<body>
  <header id="brandbar">
    <div class="brand">ToolBox Dokumentaatio</div>
    <nav>
      <a href="#overview" class="active">Yleiskatsaus</a>
      <a href="#architecture">Arkkitehtuuri</a>
      <a href="#shared-ui">Yhteinen UI</a>
      <a href="#gridgen">GridGen</a>
      <a href="#kehysgen">KehysGen</a>
      <a href="#poliisigen">PoliisiGen</a>
      <a href="#husupuffigen">HusupuffiGen</a>
      <a href="#support">Tukisivut</a>
      <a href="#assets">Resurssit</a>
      <a href="#ops">Käyttö & QA</a>
      <a href="#troubleshooting">Vianetsintä</a>
    </nav>
    <div class="spacer"></div>
    <div class="back"><a href="index.html">Takaisin etusivulle</a></div>
  </header>

  <main>
    <section id="overview" class="card">
      <h1>Yleiskatsaus</h1>
      <p>ToolBox on staattinen HTML- ja vanilla JavaScript -työkalupakki lähetysvalmiiden grafiikoiden tuottamiseen. Koko kokonaisuus löytyy tästä reposta, ja sen voi julkaista millä tahansa staattisella HTTP-palvelimella.</p>
      <div class="cols two">
        <div>
          <h3>Päätyökalut</h3>
          <ul>
            <li><b>GridGen:</b> monisoluiset kanvaskuvat geometrisilla asetteluilla.</li>
            <li><b>KehysGen:</b> MTV-kehykset ja kuvansäädöt käyttäjän valokuvalle.</li>
            <li><b>PoliisiGen:</b> poliisiteemainen yhdistelmä, jossa on tekstipalkki.</li>
            <li><b>HusupuffiGen:</b> pystysuuntainen päivittäinen aikalista.</li>
          </ul>
        </div>
        <div>
          <h3>Tukisivut</h3>
          <ul>
            <li><code>index.html</code> – etusivu navigaatiolla ja esittelykorteilla.</li>
            <li><code>docs.html</code> – tämä dokumentaatio nykytilasta.</li>
            <li><code>yhteys.html</code> – ylläpidon yhteystiedot.</li>
            <li><code>ohjeet.html</code> – varattu tuleville käyttäjäohjeille.</li>
          </ul>
        </div>
      </div>
      <div class="note">
        <h3>Tekninen yhteenveto</h3>
        <div class="tagrow">
          <span class="tag">Vanilla JS</span>
          <span class="tag">HTML Canvas</span>
          <span class="tag">IndexedDB</span>
          <span class="tag">Drag & Drop</span>
          <span class="tag">createImageBitmap</span>
          <span class="tag">PNG-vienti</span>
        </div>
      </div>
    </section>

    <section id="architecture" class="card">
      <h2>Arkkitehtuuri</h2>
      <ul>
        <li><b>Ei buildia:</b> tavalliset ES2020-skriptit ladataan <code>&lt;script src&gt;</code> -tageilla. Kehityksessä riittää mikä tahansa staattinen palvelin (esim. <code>npx serve</code> projektin juuressa).</li>
        <li><b>Canvas-työvirta:</b> jokainen generaattori piirtää esikatselukanvaalle (960x540 tai 1080x1920) ja vie tuloksen täysikokoisesta kanvaasta (1920x1080 tai 1080x1920) käyttäen samaa geometriaa.</li>
        <li><b>Kuvien suorituskyky:</b> <code>createImageBitmap</code> huolehtii dekoodauksesta. Solun tilaan tallennetaan sekä bittikartta että kuvan luonnollinen koko, jotta mittauksia ei tarvitse toistaa.</li>
        <li><b>Tila:</b> jokainen työkalu ylläpitää omaa <code>state</code>-objektiaan, joka ohjaa UI:ta, esikatselua ja vientiä. Ulkoisia tilakirjastoja ei käytetä.</li>
        <li><b>Tallennus:</b> KehysGen säilyttää ladatut kehykset IndexedDB:ssä (<code>kehysgeneraattori-db</code>), jolloin ne säilyvät uudelleenlatauksen yli. Muut työkalut pitävät kaiken muistissa.</li>
        <li><b>Assettien haku:</b> kehykset, tekstipalkit ja Husupuffin tausta haetaan <code>fetch</code>-kutsuilla. Oletus on sama origin tai CORS-otsikot.</li>
      </ul>
    </section>

    <section id="shared-ui" class="card">
      <h2>Yhteinen UI</h2>
      <div class="cols two">
        <div>
          <h3>Layout ja tyyli</h3>
          <ul>
            <li><code>styles.css</code> määrittelee etusivun, värit ja nappien tyylit.</li>
            <li>Työkalusivut käyttävät omia tyylejään (<code>kehysgen.css</code>, <code>grids.css</code>, <code>poliisigen.css</code>, <code>husupuffigen.css</code>).</li>
            <li>Yläpalkin (<code>#brandbar</code>) rakenne on sama työkaluissa, ja linkit vievät työkalusta toiseen.</li>
            <li>Värimaailma on tumma punaisilla korostuksilla; napit käyttävät yhteistä <code>.btn</code>-pohjaa.</li>
          </ul>
        </div>
        <div>
          <h3>Interaktiot</h3>
          <ul>
            <li>Kaikki kanvakset hyväksyvät kuvien drag & drop -tuonnin ja nuolinäppäimillä tehtävät hienosäädöt.</li>
            <li>Slidereiden numerot päivittyvät <code>textContent</code>-kenttiin (<code>sync...Val</code>-apuohjelmat).</li>
            <li>Työkalupalkki tarjoaa Uusi kuva-, Lataa- ja Nollaa-toiminnot samoissa kohdissa.</li>
            <li>Virheilmoitukset näytetään inline-elementeissä (<code>#warn</code>, <code>.hint</code>) modaalien sijaan.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="gridgen" class="card">
      <h2>GridGen</h2>
      <p>GridGen (<code>grids.html</code> + <code>grids.js</code>) asettelee useita kuvia geometrisiin soluihin ja mahdollistaa jakajien säätämisen.</p>
      <div class="cols two">
        <div>
          <h3>Ominaisuudet</h3>
          <ul>
            <li>Tukee suoria jakoja, 2x2-ruudukkoa, kolmea saraketta, kaaria, nuolia, timantti+4 -layouttia, ympyräspottia ja vinopalkkeja (<code>LAYOUTS</code>-taulukko).</li>
            <li>Jokaisen solun tila on <code>{img, scale, offX, offY, bright, contrast}</code>; esikatselussa käytetään <code>drawCell</code>-funktiota ja viennissä <code>drawCellExport</code>-versiota.</li>
            <li>Jakajasäätimet näytetään layoutin mukaan (<code>updateControlsVisibility()</code>).</li>
            <li>Vienti tuottaa täysikokoisen PNG:n ja lisää 16 px valkoiset viivat muotojen ympärille.</li>
          </ul>
        </div>
        <div>
          <h3>Laajentaminen</h3>
          <ul>
            <li>Lisää uudet layoutit <code>LAYOUTS</code>-listaan ja toteuta geometria-avustajat (<code>computeRects</code>, <code>build...</code>).</li>
            <li>Toteuta sama geometria sekä esikatselussa (960x540) että viennissä (1920x1080), ja skaalaa jakajan paksuus.</li>
            <li>Käytä <code>defaultCell()</code>-funktiota, kun nollaat tilaa, jotta oletusarvot pysyvät yhtenäisinä.</li>
            <li>Muista lisätä tarvittavat kontrollit HTML:ään (esim. <code>#ctrl...</code>-elementit).</li>
          </ul>
        </div>
      </div>
      <div class="note">
        <h3>Rajoitukset</h3>
        <ul>
          <li>Ei pysyvää tallennusta: sivun päivitys tyhjentää sisällön.</li>
          <li>Suodattimet rajoittuvat kirkkauteen ja kontrastiin per solu; hue, blur ja harmaasävy eivät ole oletusarvoisesti käytössä.</li>
          <li>Vienti vaatii saman originin kuvat tai CORS-otsikot (katso vianetsintä).</li>
        </ul>
      </div>
    </section>

    <section id="kehysgen" class="card">
      <h2>KehysGen</h2>
      <p>KehysGen (<code>kehysgen.html</code> + <code>kehysgen.js</code>) yhdistää käyttäjän kuvan MTV-kehyksiin ja tarjoaa laajat säätimet.</p>
      <div class="cols two">
        <div>
          <h3>Tietovirta</h3>
          <ul>
            <li>Kehykset haetaan <code>/frames/manifest.json</code>- tai <code>frames/manifest.js</code> -tiedostoista. Onnistuneet lataukset tallennetaan IndexedDB:hen offline-käyttöä varten.</li>
            <li>Kehysten metadata on <code>{id, name, thumbBlob}</code>; täysresoluutio- ja esikatselubittikartat välimuistitetaan <code>frameCache</code>-rakenteessa.</li>
            <li>Peruskuva ja lopullinen yhdistelmä käyttävät erillisiä kanvaksia; esikatselu on aina 960x540 ja vienti 1920x1080.</li>
          </ul>
        </div>
        <div>
          <h3>Muokkaustyökalut</h3>
          <ul>
            <li>Globaaleihin säätimiin kuuluvat skaala, akseleiden venytys, blur, kirkkaus, kontrasti, saturaatio, hue, harmaasävy, vinjetti ja film grain.</li>
            <li>Peilaus aktivoidaan <code>edit.flipX</code>-kentällä; nuolinäppäimet siirtävät kuvaa 10 px (Alt-näppäimellä 1 px).</li>
            <li>Latausnapit tallentavat kuvan kehyksen kanssa ja ilman kehystä (<code>downloadComposite</code>, <code>downloadBaseOnly</code>).</li>
            <li>Varoitukset näytetään <code>#warn</code>-elementissä, esimerkiksi jos kehysten lataus tai IndexedDB epäonnistuu.</li>
          </ul>
        </div>
      </div>
      <div class="note">
        <h3>Uusien kehysten lisääminen</h3>
        <ul>
          <li>Päivitä manifestitiedosto; lisää ainakin <code>file</code> ja selkeä <code>name</code>.</li>
          <li>PNG-kehysten oletuskoko on 1920x1080 läpinäkyvällä taustalla.</li>
          <li>Muista murtaa välimuisti lisäämällä kyselyparametri (manifestin lataus lisää automaattisesti <code>?v=timestamp</code>).</li>
        </ul>
      </div>
    </section>

    <section id="poliisigen" class="card">
      <h2>PoliisiGen</h2>
      <p>PoliisiGen (<code>poliisigen.html</code> + <code>poliisigen.js</code>) tuottaa poliisiteemaisen kuvan enintään kolmella valokuvalla ja valinnaisella tekstipalkilla.</p>
      <div class="cols two">
        <div>
          <h3>Layoutit ja kontrollit</h3>
          <ul>
            <li>Kolme templaten vaihtoehtoa (<code>center1</code>, <code>center2</code>, <code>center3</code>) määrää solujen määrän.</li>
            <li>Sisällön leveys, yläpuskuri ja alapuskuri ovat säädettävissä; alapuskuri voi olla negatiivinen piilottaakseen alareunan viivan.</li>
            <li>Solukohtaiset säädöt vastaavat GridGenin logiikkaa (skaala, kirkkaus, kontrasti) ja niitä hallitaan chip-napeilla.</li>
            <li>Sininen tausta ladataan tiedostosta <code>img/poliisigen_tausta.jpg</code> ja piirretään aina ensimmäiseksi.</li>
          </ul>
        </div>
        <div>
          <h3>Tekstipalkit</h3>
          <ul>
            <li>PNG-palkit voi ladata paikallisesti (monivalinta) tai manifestista <code>/poliisiframes/manifest.json</code>.</li>
            <li>Aktiivinen palkki tallennetaan kenttään <code>state.activeFrameIdx</code> ja piirretään viimeisenä, jotta tekstit jäävät päälle.</li>
            <li>Esikatselussa palkkien pikkukuvat luodaan clientissä (<code>makeThumb</code>).</li>
            <li>Nollaus tyhjentää solujen sisällön, mutta pitää ladatut palkit tallessa kunnes ne poistetaan.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="husupuffigen" class="card">
      <h2>HusupuffiGen</h2>
      <p>HusupuffiGen (<code>husupuffigen.html</code> + <code>husupuffigen.js</code>) tekee pystysuuntaisen 1080x1920-aikataulukortin MTV-brändillä.</p>
      <div class="cols two">
        <div>
          <h3>Canvas-putki</h3>
          <ul>
            <li>Taustakuva (<code>img/husupuffipohja.jpg</code>) piirretään cover-tyylisesti, jotta koko kanvas täyttyy.</li>
            <li><code>ensureFontLoaded()</code> varmistaa, että Quattro News Bold on käytettävissä ennen piirtämistä.</li>
            <li>Otsikko jaetaan kahteen riviin ja automaattinen fonttikoko vaihtelee 72–42 pikselin välillä.</li>
            <li>Aikataulun rivit tunnistetaan muodosta <code>HH.MM Otsikko</code> ja ne esitetään kahdessa sarakkeessa (aika + otsikko).</li>
          </ul>
        </div>
        <div>
          <h3>Syötteet</h3>
          <ul>
            <li>Ensimmäinen otsikkorivi ja viikonpäivä muodostavat kultaisen otsikon.</li>
            <li><code>#schedule</code>-tekstialue hyväksyy vapaamuotoiset rivit; tyhjät rivit lisäävät väliä.</li>
            <li>Alateksti keskitetään ja ankkuroidaan 150 px marginaalilla alareunasta.</li>
            <li>Lataa PNG -nappi tekee uuden piirron ennen vientiä, jotta syötteet ovat ajantasaiset.</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="support" class="card">
      <h2>Tukisivut</h2>
      <div class="cols two">
        <div>
          <h3>Etusivu (<code>index.html</code>)</h3>
          <ul>
            <li>Listaa generaattorit ja tulevat editorit esittelykorteilla (<code>styles.css</code>).</li>
            <li>Navigaationapit vievät dokumentaatioon ja yhteyssivulle.</li>
            <li><code>.badge</code>-tyyli merkitsee keskeneräiset työkalut (esim. KuvaGen).</li>
          </ul>
        </div>
        <div>
          <h3>Yhteys (<code>yhteys.html</code>)</h3>
          <ul>
            <li>Esittelee ylläpitäjän tiedot (sähköposti, puhelin) tummassa teemassa.</li>
            <li>Käyttää sivukohtaisia tyylejä; yhteiset tyylit voi jakaa myöhemmin.</li>
            <li>Sisältää pikalinkin takaisin etusivulle.</li>
          </ul>
        </div>
      </div>
      <div class="note">
        <h3>Tulevaa</h3>
        <ul>
          <li><code>ohjeet.html</code> on tyhjä ja voi sisältää jatkossa käyttäjäoppaat.</li>
          <li>Dokkarin osioita voi linkittää suoraan työkalujen UI:hin, kun sisältö vakiintuu.</li>
        </ul>
      </div>
    </section>

    <section id="assets" class="card">
      <h2>Resurssit ja hakemistot</h2>
      <table>
        <thead>
          <tr>
            <th>Polku</th>
            <th>Tarkoitus</th>
            <th>Huomioita</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>img/</code></td>
            <td>Yhteiset kuvat (etusivun thumbnailit, Husupuffin tausta, PoliisiGen-tausta).</td>
            <td>Aja HTTP:n yli; vältä <code>file://</code>-polkuja, jotta kanvasvienti toimii.</td>
          </tr>
          <tr>
            <td><code>frames/</code></td>
            <td>KehysGenin PNG-kehykset ja manifesti (JSON tai JS).</td>
            <td>Manifestissa tulisi olla vähintään <code>id</code>, <code>file</code> ja halutessa <code>name</code>.</td>
          </tr>
          <tr>
            <td><code>poliisiframes/</code></td>
            <td>PoliisiGenin tekstipalkit ja <code>manifest.json</code>.</td>
            <td>PNG:n kannattaa olla viennin kokoinen (1920x1080).</td>
          </tr>
          <tr>
            <td><code>kehysgen.css</code>, <code>grids.css</code>, <code>poliisigen.css</code>, <code>husupuffigen.css</code></td>
            <td>Työkalukohtaiset layoutit ja komponenttien tyylit.</td>
            <td>Pidä selektorit rajattuina, jotta työkalut eivät sotke toisiaan.</td>
          </tr>
          <tr>
            <td><code>kehysgen.js</code>, <code>grids.js</code>, <code>poliisigen.js</code>, <code>husupuffigen.js</code></td>
            <td>Työkalun logiikka (tila, renderöinti, vienti ja eventit).</td>
            <td>Skriptit olettavat, että DOM on valmiina lataushetkellä (ei bundleria).</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section id="ops" class="card">
      <h2>Käyttö ja QA -tarkistuslista</h2>
      <ul>
        <li><b>Aja paikallisesti:</b> käytä <code>npx serve</code>-komentoa tai vastaavaa repositorion juuressa välttääksesi CORS-ongelmat.</li>
        <li><b>Smoke-testi julkaisut:</b> avaa jokainen generaattori, pudota kuvat joka soluun, tee vienti ja varmista PNG-mitat.</li>
        <li><b>Manifestin tarkistus:</b> päivitä kehykset/tekstipalkit manifestin muutosten jälkeen ja varmista, että välimuisti päivittyy (IndexedDB:n tyhjennysnappi aloittaa alusta).</li>
        <li><b>Selaintuki:</b> ensisijainen kohde on Chromium-pohjaiset työpöytäselaimet; testaa Safari/Firefox kun otat käyttöön uusia API-ominaisuuksia.</li>
        <li><b>Suorituskyky:</b> suuret kuvat nojaavat <code>createImageBitmap</code>-funktioon; huomioi muistinkäyttö, jos lisäät raskaita suodattimia.</li>
      </ul>
    </section>

    <section id="troubleshooting" class="card">
      <h2>Vianetsintä</h2>
      <details open>
        <summary>PNG-vienti epäonnistuu</summary>
        <ul>
          <li>Varmista, että jokainen kuva tulee samasta originista tai palauttaa <code>Access-Control-Allow-Origin</code> -otsakkeen. Muuten kanvas merkitään "taintediksi" ja <code>toBlob/toDataURL</code> heittää virheen.</li>
          <li>Älä avaa työkaluja <code>file://</code>-protokollan kautta; käytä paikallista HTTP-palvelinta.</li>
        </ul>
      </details>
      <details>
        <summary>Kehykset tai tekstipalkit eivät näy</summary>
        <ul>
          <li>Tarkista, että <code>frames/manifest.json</code> tai <code>poliisiframes/manifest.json</code> on saavutettavissa ja palauttaa validia JSON:ia.</li>
          <li>Käytä työkalun päivitysnappia, kun lisäät uusia assetteja.</li>
          <li>Jos IndexedDB-välimuisti menee rikki, tyhjennä se selaimen devtoolsista.</li>
        </ul>
      </details>
      <details>
        <summary>Esikatselu on hidas</summary>
        <ul>
          <li>Pidä esikatselukanvas 960x540-koossa (jo toteutettu) minimoidaksesi piirrot.</li>
          <li>Hyödynnä muistissa olevia bittikarttoja, älä dekoodaa <code>Image</code>-elementtejä uudelleen.</li>
          <li>Käytä blur- ja grain-suodattimia vain tarvittaessa – molemmat ovat raskaita GPU:lle.</li>
        </ul>
      </details>
    </section>
  </main>
</body>
</html>

