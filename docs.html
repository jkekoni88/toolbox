<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ToolBox – Dokumentaatio (Dev)</title>
  <style>
    :root{
      --bg:#111827; --bg2:#0f172a; --ink:#f9fafb; --muted:#cbd5e1; --muter:#94a3b8;
      --brand:#0b1120; --red:#dc2626; --red2:#b91c1c; --border:#1f2937;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
    #brandbar{
      position:sticky;top:0;z-index:3;background:var(--brand);color:#fff;
      display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid var(--border)
    }
    #brandbar .brand{font-weight:700;letter-spacing:.3px}
    #brandbar nav{display:flex;gap:10px;margin-left:10px}
    #brandbar nav a{color:#d1d5db;text-decoration:none;padding:6px 10px;border-radius:6px;font-size:13px}
    #brandbar nav a.active{background:#b91c1c;color:#fff}
    #brandbar nav a:hover{background:#dc2626;color:#fff}
    #brandbar .spacer{flex:1}
    #brandbar .back a{color:#fff;text-decoration:none;font-weight:600}
    #brandbar .back a:hover{text-decoration:underline}

    main{max-width:1100px;margin:24px auto;padding:0 16px;display:grid;gap:24px}
    .card{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:16px;display:grid;gap:12px}
    h1{font-size:28px;margin:0 0 6px}
    h2{font-size:18px;margin:8px 0}
    h3{font-size:15px;margin:8px 0;color:var(--muted)}
    p,li{color:var(--muted)}
    code,kbd{background:#0b1220;border:1px solid var(--border);border-radius:6px;padding:.1em .35em}
    pre{background:#0b1220;border:1px solid var(--border);border-radius:8px;padding:12px;overflow:auto}
    .list{display:grid;gap:6px;margin:0;padding-left:18px}
    .note{background:#0b1220;border:1px solid var(--border);border-radius:10px;padding:12px}
    .btn{display:inline-block;background:var(--red);color:#fff;border:1px solid var(--red2);padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:600}
    .btn:hover{background:#ef4444}
    a, a:visited, a:hover, a:active{color:#fff;font-weight:700;text-decoration:underline}
  </style>
</head>
<body>
  <header id="brandbar">
    <div class="brand">ToolBox Dokumentaatio (Dev)</div>
    <nav>
    
      <a href="kehysgen.html">KehysGen</a>
      <a href="grids.html">GridGen</a>
      <a href="poliisigen.html">PoliisiGen</a>
      <a href="husupuffigen.html">HusupuffiGen</a>
    </nav>
    <div class="spacer"></div>
    <div class="back"><a href="index.html">← Takaisin etusivulle</a></div>
  </header>

  <main>
    <!-- YLEISTÄ -->
    <section class="card">
      <h1>Yleistä</h1>
      <ul class="list">
        <li>Natiivikoko vaakageneraattoreissa on <b>1920×1080</b>. Esikatselu (canvas) on <b>960×540</b>. <!-- :contentReference[oaicite:0]{index=0} --></li>
        <li>HusupuffiGen on pystyformaatti <b>1080×1920</b>. <!-- :contentReference[oaicite:1]{index=1} --></li>
        <li>“Lataa kuva”/vienti tekee PNG:n käyttäen samaa geometriaa kuin esikatselussa (vain skaala vaihtuu). Esim. HusupuffiGen piirtää ennen <code>toBlob</code>:ia ja tallentaa PNG:n. <!-- :contentReference[oaicite:2]{index=2} --></li>
      </ul>

      <div class="note">
        <h3>Miksi “Lataa kuva” voi joskus epäonnistua?</h3>
        <p><b>Selaimen suojausrajoitus (CORS)</b>: jos canvasille piirretty kuva on ladattu eri originista ilman sallivia CORS-otsikoita, selain voi estää viennin (esim. <code>toBlob()</code>/<code>toDataURL()</code>). Ratkaisut: sama origin, tai kuville CORS ja <code>crossorigin="anonymous"</code>. <!-- :contentReference[oaicite:3]{index=3} --></p>
        <ul class="list">
          <li><b>Ratkaisu 1:</b> Pidä kuvat samalta originilta.</li>
          <li><b>Ratkaisu 2:</b> Tarjoa CORS-otsikot ja lataa kuvat <code>crossorigin="anonymous"</code>. <!-- :contentReference[oaicite:4]{index=4} --></li>
          <li><b>Ratkaisu 3:</b> Älä käytä <code>file://</code>-polkuja; aja paikallinen http-palvelin.</li>
        </ul>
      </div>
    </section>

    <!-- KEHYS GEN -->
    <section class="card">
      <h2>KehysGen</h2>
      <p>KehysGen piirtää käyttäjän kuvan päälle valitun PNG-kehyksen ja tarjoaa perussäädöt/efektit. Kuvaa voi raahata esikatselussa (pointer down → move). <!-- :contentReference[oaicite:5]{index=5} --></p>

      <h3>Keskeinen arkkitehtuuri</h3>
      <ul class="list">
        <li><b>Canvas-koot:</b> esikatselu <code>PREV_W×PREV_H</code>, vienti 1920×1080. Käyttäjän kuva skaalataan preview’lle ja säilytetään täysikokoisena vientiä varten. <!-- :contentReference[oaicite:6]{index=6} --></li>
        <li><b>Kehysten lataus:</b> listaus luetaan <code>/frames/manifest.json</code> → kortit sivupalkkiin; ensimmäinen aktivoidaan automaattisesti. <!-- :contentReference[oaicite:7]{index=7} --></li>
        <li><b>UI-toiminnot:</b> kehyslistan päivitys/tyhjennys, “Ei kehystä”, uudelleen-piirto. <!-- :contentReference[oaicite:8]{index=8} :contentReference[oaicite:9]{index=9} --></li>
        <li><b>Drag & Drop:</b> käyttäjä voi pudottaa PNG/JPG:n suoraan. <!-- :contentReference[oaicite:10]{index=10} --></li>
      </ul>

      <h3>Vienti</h3>
      <ul class="list">
        <li>Kuva piirretään kehyksen kanssa 1920×1080:aan ja tallennetaan PNG:ksi. (Täysikoon bitmap pidetään erillään esikatselusta.) <!-- :contentReference[oaicite:11]{index=11} --></li>
      </ul>

      <div class="note">
        <h3>Vinkit kehysten lisäämiseen</h3>
        <ol class="list">
          <li>Lisää kehysten PNG:t kansioon <code>/frames</code> ja päivitä <code>manifest.json</code>.</li>
          <li>Manifestin luvun jälkeen UI aktivoidaan ja <em>ensureFrameBitmapsLoaded</em> varmistaa bittikartat. <!-- :contentReference[oaicite:12]{index=12} --></li>
        </ol>
      </div>
    </section>

    <!-- GRID GEN -->
    <section class="card">
      <h2>GridGen</h2>
      <p>GridGen rakentaa yhdistelmäkuvia useista soluista; per-solu säädöt (skaala, kirkkaus, kontrasti, harmaasävy, blur) ja useita layoutteja (suorat jaot, kaaret/nuolet, timantti, ympyrä, vinopalkit). <!-- :contentReference[oaicite:13]{index=13} :contentReference[oaicite:14]{index=14} --></p>

      <h3>Layoutit & tila</h3>
      <ul class="list">
        <li><b>Peruskoot:</b> <code>W=1920</code>, <code>H=1080</code>, esikatselu <code>960×540</code>; jakoviiva 16 px. <!-- :contentReference[oaicite:15]{index=15} --></li>
        <li><b>Layout-lista:</b> rect2v, rect2h, rect2x2, rect3, curve-left/right, chevron-left/right, diamond-5, circle, slanted-left/right. <!-- :contentReference[oaicite:16]{index=16} --></li>
        <li><b>Tilaobjekti:</b> valittu layout, valittu solu, ja layout-kohtaiset ohjaimet (esim. <code>curvePosPct</code>, <code>diamondWidthPct</code>, <code>circle.xPct/sizePct</code>, <code>slantedAngleDeg</code>). <!-- :contentReference[oaicite:17]{index=17} --></li>
        <li><b>Solujen määritys:</b> <code>initCellsForLayout()</code> luo solut layoutin mukaan; ympyrä-layoutissa indeksi 0 = ympyrä, 1 = tausta. <!-- :contentReference[oaicite:18]{index=18} --></li>
      </ul>

      <h3>UI-sidonnat</h3>
      <ul class="list">
        <li>Kaikki ohjaimet kerätään <code>els</code>-olioon, mukaan lukien divider-säätimet, 2×2, curve, diamond, circle, slanted ja solupaneeli. <!-- :contentReference[oaicite:19]{index=19} :contentReference[oaicite:20]{index=20} :contentReference[oaicite:21]{index=21} --></li>
      </ul>

      <h3>Piirto & vienti</h3>
      <ul class="list">
        <li>Esikatselu piirretään <code>PREV_W×PREV_H</code> -canvasille samoilla kaavoilla kuin vienti. <!-- :contentReference[oaicite:22]{index=22} --></li>
        <li>Vienti 1920×1080: layout-kohtaiset polut (curve/chevron/slanted) klippaavat solut; diamond-5 leikkaa kulmien pathit; circle käyttää ympyräklippiä + reunaviivaa. <!-- :contentReference[oaicite:23]{index=23} --></li>
      </ul>
    </section>

    <!-- POLIISI GEN -->
    <section class="card">
      <h2>PoliisiGen</h2>
      <p>PoliisiGen keskittää 1–3 solua siniselle taustalle; jokaisessa solussa on valkoinen stroke ja optionaalinen tekstipalkki (PNG) päälle. <!-- :contentReference[oaicite:24]{index=24} --></p>

      <h3>Layout, solut ja säätimet</h3>
      <ul class="list">
        <li>Layout valitaan painikkeista; koodissa <code>state.layout</code> päivittyy ja UI synkronoidaan. <!-- :contentReference[oaicite:25]{index=25} --></li>
        <li>Sisältöalueen leveys, ylä- ja alavälit: <code>contentW</code>, <code>topPad</code>, <code>bottomPad</code>; UI heijastaa arvoja. <!-- :contentReference[oaicite:26]{index=26} --></li>
        <li>Per-solu ohjaimet: skaala, kirkkaus, kontrasti, keskitys, reset. <!-- :contentReference[oaicite:27]{index=27} :contentReference[oaicite:28]{index=28} --></li>
      </ul>

      <h3>Tekstipalkit (frames)</h3>
      <ul class="list">
        <li>PNG:t voi lisätä joko <em>manifestista</em> (JSON fetch) tai <em>paikallisesti</em> tiedostovalinnalla; molemmista muodostetaan thumbnailit ja listaus. <!-- :contentReference[oaicite:29]{index=29} :contentReference[oaicite:30]{index=30} --></li>
        <li>Aktivointi vaihtaa <code>state.activeFrameIdx</code> ja triggaa <code>drawPreview()</code>. <!-- :contentReference[oaicite:31]{index=31} --></li>
      </ul>

      <h3>Vienti</h3>
      <ul class="list">
        <li>Luodaan uusi 1920×1080-canvas, piirretään tausta coverilla tai yksivärisenä, sitten solurectit klippinä, kuvat ja 16 px stroke, lopuksi tekstipalkki. <!-- :contentReference[oaicite:32]{index=32} :contentReference[oaicite:33]{index=33} --></li>
        <li>Tallennus <code>toBlob</code> tai fallback <code>toDataURL</code>. <!-- :contentReference[oaicite:34]{index=34} --></li>
      </ul>
    </section>

    <!-- HUSUPUFFI GEN -->
    <section class="card">
      <h2>HusupuffiGen</h2>
      <p>Pysty 1080×1920; otsikko kahdella rivillä (autofit), aikataululista (kellonaika + otsikko) ja alateksti, kaikki boldina “Quattro News” -fontilla. <!-- :contentReference[oaicite:35]{index=35} :contentReference[oaicite:36]{index=36} --></p>

      <h3>Typografia & mitoitus</h3>
      <ul class="list">
        <li>HEADLINE_BASE ~72 px (min 42), leipä 44 px, footer 55 px; rivivälit: body 70 px, footer ~1.28×. <!-- :contentReference[oaicite:37]{index=37} --></li>
        <li>Otsikko auto-skaalataan <code>fitHeadlineSize</code>-funktiolla mahtumaan palstaan. <!-- :contentReference[oaicite:38]{index=38} --></li>
        <li>Aikakolumni mittaa leveytensä dynaamisesti, otsikko rivitetään oikeaan palstaan. <!-- :contentReference[oaicite:39]{index=39} :contentReference[oaicite:40]{index=40} --></li>
      </ul>

      <h3>Piirtojärjestys & vienti</h3>
      <ul class="list">
        <li>Tausta cover → otsikko → aikataulu → footer; vienti tapahtuu suoraan esikatselucanvasista <code>toBlob</code>-kutsulla. <!-- :contentReference[oaicite:41]{index=41} :contentReference[oaicite:42]{index=42} --></li>
        <li>Fontit varmistetaan ennen piirtämistä <code>document.fonts.load</code>/<code>document.fonts.ready</code>. <!-- :contentReference[oaicite:43]{index=43} --></li>
      </ul>
    </section>

    <!-- VIENTI & VIKATILANTEET -->
    <section class="card">
      <h2>Vienti ja vianetsintä</h2>
      <ul class="list">
        <li><b>PNG-vienti:</b> kaikissa työkaluissa geometria on sama esikatselun ja viennin välillä (vain canvas-koko vaihtuu). <!-- :contentReference[oaicite:44]{index=44} :contentReference[oaicite:45]{index=45} --></li>
        <li><b>CORS:</b> jos tausta/kuva on toisesta originista ilman CORS:ia, <code>toBlob</code>/<code>toDataURL</code> voi epäonnistua. Käytä samaa originia tai salli CORS + <code>crossorigin="anonymous"</code>. <!-- :contentReference[oaicite:46]{index=46} :contentReference[oaicite:47]{index=47} --></li>
      </ul>
      <p><a class="btn" href="index.html">← Takaisin etusivulle</a></p>
    </section>
  </main>
</body>
</html>
